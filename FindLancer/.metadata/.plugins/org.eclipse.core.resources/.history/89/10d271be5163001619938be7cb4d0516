package br.com.findlancer.sql;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import br.com.findlancer.model.Endereco;

public class EnderecoDAO {

	Connection conexaoDB = Conexao.conectar();
	
	public int cadastrarEndereco(Endereco endereco){
		
		int Fk = 0;
		
		//Comando para o insert no banco
		String sql="INSERT INTO enderecos (numero, cep, bairro, fk_cidade, nome_Rua) VALUES ( ?, ?, ?, ?, ?);";
		try {
			//Preparando a query
			PreparedStatement stmt = conexaoDB.prepareStatement(sql);
			
			//Atribuir os parametros da query
			stmt.setInt(1, endereco.getNumero());
			stmt.setInt(2, endereco.getCep());
			stmt.setString(3, endereco.getBairro());
			stmt.setInt(4, endereco.getFk_cidade());
			stmt.setString(5, endereco.getNomeRua());
			
			//executar o insert 
			stmt.execute();
			
			System.out.println("Endereco cadastrado");
			Fk=retornarFk();
		} catch (SQLException e) {
			System.out.println("Endereco nao cadastrado");
			 
		}
		return Fk;
	}
	
	
	public int retornarFk(){
		int FkEnd=0;
		//Comando query 
		String sql="select idEndereco from enderecos ORDER by  idEndereco desc limit 1";
		
		//try para tentar executar a query
		try {
			//preparar a query
			PreparedStatement stmt = conexaoDB.prepareStatement(sql);
			//Executando e armazenando da query
			ResultSet resultado= stmt.executeQuery();
			
			//While para receber resultado da query
			while(resultado.next()){
				FkEnd=resultado.getInt(1);
			}
		} catch (SQLException e) {
			 
		}
		
		
		return FkEnd;
	}
	
	//Método que realiza busca por id de endereco
	public Endereco buscarPorId(int id){
		//String com o comando sql para a query
		String sql = "select * from enderecos where idEndereco = ?";
		Endereco endereco = null;
		//Try para tentar executar a query
		try {
			//Preparando o statement
			PreparedStatement stmt = conexaoDB.prepareStatement(sql);
			stmt.setInt(1, id);
			//Executando a query e armazenando seu resultado
			ResultSet resultado = stmt.executeQuery();
			
			//While para armazenar os dados retornados pela query
			while(resultado.next()){
				endereco.setNumero(resultado.getString(2));
				endereco.setCep(resultado.getInt(3));
				endereco.setCep(resultado.getInt(3));
			}
			
		} catch (SQLException e) {
			
		}
		
		
	}
	
}
